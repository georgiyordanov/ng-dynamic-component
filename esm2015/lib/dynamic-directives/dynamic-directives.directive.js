import { Directive, ElementRef, EventEmitter, Inject, Injector, Input, IterableDiffers, Optional, Output, } from '@angular/core';
import { DynamicComponentInjectorToken, } from '../component-injector';
import { IoFactoryService } from '../io';
import { extractNgParamTypes, getCtorParamTypes } from '../util';
import { WindowRefService } from '../window-ref';
export function dynamicDirectiveDef(type, inputs, outputs) {
    return { type, inputs, outputs };
}
export class DynamicDirectivesDirective {
    constructor(iterableDiffers, ioFactoryService, windowRef, componentInjector) {
        this.iterableDiffers = iterableDiffers;
        this.ioFactoryService = ioFactoryService;
        this.windowRef = windowRef;
        this.componentInjector = componentInjector;
        this.ndcDynamicDirectivesCreated = new EventEmitter();
        this.dirRef = new Map();
        this.dirIo = new Map();
        this.dirsDiffer = this.iterableDiffers
            .find([])
            .create((_, def) => def.type);
    }
    get directives() {
        return (this.ndcDynamicDirectives || this.ngComponentOutletNdcDynamicDirectives);
    }
    get componentRef() {
        return this.componentInjector.componentRef;
    }
    get compInstance() {
        return this.componentRef && this.componentRef.instance;
    }
    get isCompChanged() {
        if (this.lastCompInstance !== this.compInstance) {
            this.lastCompInstance = this.compInstance;
            return true;
        }
        return false;
    }
    get hostInjector() {
        return this.componentRef.injector;
    }
    get hostVcr() {
        // NOTE: Accessing private APIs of Angular
        // tslint:disable-next-line: no-string-literal
        return this.componentRef['_viewRef']['_viewContainerRef'];
    }
    get reflect() {
        return this.windowRef.nativeWindow.Reflect;
    }
    ngDoCheck() {
        if (this.maybeDestroyDirectives()) {
            return;
        }
        const dirsChanges = this.dirsDiffer.diff(this.directives);
        if (!dirsChanges) {
            return this.updateDirectives();
        }
        this.processDirChanges(dirsChanges);
    }
    ngOnDestroy() {
        this.destroyAllDirectives();
    }
    maybeDestroyDirectives() {
        if (this.isCompChanged || !this.componentRef) {
            this.dirsDiffer.diff([]);
            this.destroyAllDirectives();
        }
        return !this.componentRef;
    }
    processDirChanges(changes) {
        changes.forEachRemovedItem(({ item }) => this.destroyDirective(item));
        const createdDirs = [];
        changes.forEachAddedItem(({ item }) => createdDirs.push(this.initDirective(item)));
        if (createdDirs.length) {
            this.ndcDynamicDirectivesCreated.emit(createdDirs.filter(Boolean));
        }
    }
    updateDirectives() {
        this.directives.forEach(dir => this.updateDirective(dir));
    }
    updateDirective(dirDef) {
        const io = this.dirIo.get(dirDef.type);
        io.update(dirDef.inputs, dirDef.outputs, false, false);
        io.maybeUpdate();
    }
    initDirective(dirDef) {
        if (this.dirRef.has(dirDef.type)) {
            return;
        }
        const instance = this.createDirective(dirDef.type);
        const dir = {
            instance,
            type: dirDef.type,
            injector: this.hostInjector,
            hostComponent: this.componentRef.instance,
            hostView: this.componentRef.hostView,
            location: this.componentRef.location,
            changeDetectorRef: this.componentRef.changeDetectorRef,
            onDestroy: this.componentRef.onDestroy,
        };
        this.initDirIO(dir, dirDef.inputs, dirDef.outputs);
        this.callInitHooks(instance);
        this.dirRef.set(dir.type, dir);
        return dir;
    }
    destroyAllDirectives() {
        this.dirRef.forEach(dir => this.destroyDirRef(dir));
        this.dirRef.clear();
        this.dirIo.clear();
    }
    destroyDirective(dirDef) {
        this.destroyDirRef(this.dirRef.get(dirDef.type));
        this.dirRef.delete(dirDef.type);
        this.dirIo.delete(dirDef.type);
    }
    initDirIO(dir, inputs, outputs) {
        const io = this.ioFactoryService.create();
        io.init({ componentRef: this.dirToCompDef(dir) }, { trackOutputChanges: true });
        io.update(inputs, outputs, !!inputs, !!outputs);
        this.dirIo.set(dir.type, io);
    }
    dirToCompDef(dir) {
        return {
            changeDetectorRef: this.componentRef.changeDetectorRef,
            hostView: this.componentRef.hostView,
            location: this.componentRef.location,
            destroy: this.componentRef.destroy,
            onDestroy: this.componentRef.onDestroy,
            injector: this.componentRef.injector,
            instance: dir.instance,
            componentType: dir.type,
        };
    }
    destroyDirRef(dir) {
        const io = this.dirIo.get(dir.type);
        io.ngOnDestroy();
        if ('ngOnDestroy' in dir.instance) {
            dir.instance.ngOnDestroy();
        }
    }
    createDirective(dirType) {
        const directiveInjector = Injector.create({
            providers: [
                {
                    provide: dirType,
                    useClass: dirType,
                    deps: this.resolveDirParamTypes(dirType),
                },
                { provide: ElementRef, useValue: this.componentRef.location },
            ],
            parent: this.hostInjector,
            name: `DynamicDirectiveInjector:${dirType.name}@${this.componentRef.componentType.name}`,
        });
        return directiveInjector.get(dirType);
    }
    resolveDirParamTypes(dirType) {
        var _a, _b;
        return (
        // First try Angular Compiler's metadata
        (_b = (_a = extractNgParamTypes(dirType)) !== null && _a !== void 0 ? _a : 
        // Then fallback to Typescript Reflect API
        getCtorParamTypes(dirType, this.reflect)) !== null && _b !== void 0 ? _b : 
        // Bailout
        []);
    }
    callInitHooks(obj) {
        this.callHook(obj, 'ngOnInit');
        this.callHook(obj, 'ngDoCheck');
        this.callHook(obj, 'ngAfterContentInit');
        this.callHook(obj, 'ngAfterContentChecked');
        this.callHook(obj, 'ngAfterViewInit');
        this.callHook(obj, 'ngAfterViewChecked');
    }
    callHook(obj, hook, args = []) {
        if (obj[hook]) {
            obj[hook](...args);
        }
    }
}
DynamicDirectivesDirective.decorators = [
    { type: Directive, args: [{
                selector: '[ndcDynamicDirectives],[ngComponentOutletNdcDynamicDirectives]',
                providers: [IoFactoryService],
            },] }
];
/** @nocollapse */
DynamicDirectivesDirective.ctorParameters = () => [
    { type: IterableDiffers },
    { type: IoFactoryService },
    { type: WindowRefService },
    { type: undefined, decorators: [{ type: Inject, args: [DynamicComponentInjectorToken,] }, { type: Optional }] }
];
DynamicDirectivesDirective.propDecorators = {
    ndcDynamicDirectives: [{ type: Input }],
    ngComponentOutletNdcDynamicDirectives: [{ type: Input }],
    ndcDynamicDirectivesCreated: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1pYy1kaXJlY3RpdmVzLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25nLWR5bmFtaWMtY29tcG9uZW50L3NyYy9saWIvZHluYW1pYy1kaXJlY3RpdmVzL2R5bmFtaWMtZGlyZWN0aXZlcy5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUdMLFNBQVMsRUFFVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLE1BQU0sRUFDTixRQUFRLEVBQ1IsS0FBSyxFQUVMLGVBQWUsRUFFZixRQUFRLEVBQ1IsTUFBTSxHQUlQLE1BQU0sZUFBZSxDQUFDO0FBRXZCLE9BQU8sRUFFTCw2QkFBNkIsR0FDOUIsTUFBTSx1QkFBdUIsQ0FBQztBQUMvQixPQUFPLEVBQWMsZ0JBQWdCLEVBQTBCLE1BQU0sT0FBTyxDQUFDO0FBQzdFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUNqRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFRakQsTUFBTSxVQUFVLG1CQUFtQixDQUNqQyxJQUFhLEVBQ2IsTUFBbUIsRUFDbkIsT0FBcUI7SUFFckIsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLENBQUM7QUFDbkMsQ0FBQztBQWtCRCxNQUFNLE9BQU8sMEJBQTBCO0lBcURyQyxZQUNVLGVBQWdDLEVBQ2hDLGdCQUFrQyxFQUNsQyxTQUEyQixFQUczQixpQkFBNEM7UUFMNUMsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBQ2hDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsY0FBUyxHQUFULFNBQVMsQ0FBa0I7UUFHM0Isc0JBQWlCLEdBQWpCLGlCQUFpQixDQUEyQjtRQXBEdEQsZ0NBQTJCLEdBQUcsSUFBSSxZQUFZLEVBQXVCLENBQUM7UUF3QzlELFdBQU0sR0FBRyxJQUFJLEdB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cEI7SUFDSCxDQUFDOzs7WUF0T0YsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxnRUFBZ0U7Z0JBQzFFLFNBQVMsRUFBRSxDQUFDLGdCQUFnQixDQUFDO2FBQzlCOzs7O1lBOUNDLGVBQWU7WUFhSSxnQkFBZ0I7WUFFNUIsZ0JBQWdCOzRDQXlGcEIsTUFBTSxTQUFDLDZCQUE2QixjQUNwQyxRQUFROzs7bUNBekRWLEtBQUs7b0RBRUwsS0FBSzswQ0FHTCxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudFJlZixcbiAgRGlyZWN0aXZlLFxuICBEb0NoZWNrLFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIEluamVjdCxcbiAgSW5qZWN0b3IsXG4gIElucHV0LFxuICBJdGVyYWJsZUNoYW5nZXMsXG4gIEl0ZXJhYmxlRGlmZmVycyxcbiAgT25EZXN0cm95LFxuICBPcHRpb25hbCxcbiAgT3V0cHV0LFxuICBUeXBlLFxuICBWaWV3Q29udGFpbmVyUmVmLFxuICBWaWV3UmVmLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHtcbiAgRHluYW1pY0NvbXBvbmVudEluamVjdG9yLFxuICBEeW5hbWljQ29tcG9uZW50SW5qZWN0b3JUb2tlbixcbn0gZnJvbSAnLi4vY29tcG9uZW50LWluamVjdG9yJztcbmltcG9ydCB7IElucHV0c1R5cGUsIElvRmFjdG9yeVNlcnZpY2UsIElvU2VydmljZSwgT3V0cHV0c1R5cGUgfSBmcm9tICcuLi9pbyc7XG5pbXBvcnQgeyBleHRyYWN0TmdQYXJhbVR5cGVzLCBnZXRDdG9yUGFyYW1UeXBlcyB9IGZyb20gJy4uL3V0aWwnO1xuaW1wb3J0IHsgV2luZG93UmVmU2VydmljZSB9IGZyb20gJy4uL3dpbmRvdy1yZWYnO1xuXG5leHBvcnQgaW50ZXJmYWNlIER5bmFtaWNEaXJlY3RpdmVEZWY8VD4ge1xuICB0eXBlOiBUeXBlPFQ+O1xuICBpbnB1dHM/OiBJbnB1dHNUeXBlO1xuICBvdXRwdXRzPzogT3V0cHV0c1R5cGU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkeW5hbWljRGlyZWN0aXZlRGVmPFQ+KFxuICB0eXBlOiBUeXBlPFQ+LFxuICBpbnB1dHM/OiBJbnB1dHNUeXBlLFxuICBvdXRwdXRzPzogT3V0cHV0c1R5cGUsXG4pOiBEeW5hbWljRGlyZWN0aXZlRGVmPFQ+IHtcbiAgcmV0dXJuIHsgdHlwZSwgaW5wdXRzLCBvdXRwdXRzIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGlyZWN0aXZlUmVmPFQ+IHtcbiAgaW5zdGFuY2U6IFQ7XG4gIHR5cGU6IFR5cGU8VD47XG4gIGluamVjdG9yOiBJbmplY3RvcjtcbiAgaG9zdENvbXBvbmVudDogVHlwZTxhbnk+O1xuICBob3N0VmlldzogVmlld1JlZjtcbiAgbG9jYXRpb246IEVsZW1lbnRSZWY7XG4gIGNoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZjtcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBiYW4tdHlwZXNcbiAgb25EZXN0cm95OiAoY2FsbGJhY2s6IEZ1bmN0aW9uKSA9PiB2b2lkO1xufVxuXG5ARGlyZWN0aXZlKHtcbiAgc2VsZWN0b3I6ICdbbmRjRHluYW1pY0RpcmVjdGl2ZXNdLFtuZ0NvbXBvbmVudE91dGxldE5kY0R5bmFtaWNEaXJlY3RpdmVzXScsXG4gIHByb3ZpZGVyczogW0lvRmFjdG9yeVNlcnZpY2VdLFxufSlcbmV4cG9ydCBjbGFzcyBEeW5hbWljRGlyZWN0aXZlc0RpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uRGVzdHJveSwgRG9DaGVjayB7XG4gIEBJbnB1dCgpXG4gIG5kY0R5bmFtaWNEaXJlY3RpdmVzOiBEeW5hbWljRGlyZWN0aXZlRGVmPGFueT5bXTtcbiAgQElucHV0KClcbiAgbmdDb21wb25lbnRPdXRsZXROZGNEeW5hbWljRGlyZWN0aXZlczogRHluYW1pY0RpcmVjdGl2ZURlZjxhbnk+W107XG5cbiAgQE91dHB1dCgpXG4gIG5kY0R5bmFtaWNEaXJlY3RpdmVzQ3JlYXRlZCA9IG5ldyBFdmVudEVtaXR0ZXI8RGlyZWN0aXZlUmVmPGFueT5bXT4oKTtcblxuICBwcml2YXRlIGxhc3RDb21wSW5zdGFuY2U6IGFueTtcblxuICBwcml2YXRlIGdldCBkaXJlY3RpdmVzKCkge1xuICAgIHJldHVybiAoXG4gICAgICB0aGlzLm5kY0R5bmFtaWNEaXJlY3RpdmVzIHx8IHRoaXMubmdDb21wb25lbnRPdXRsZXROZGNEeW5hbWljRGlyZWN0aXZlc1xuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGdldCBjb21wb25lbnRSZWYoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29tcG9uZW50SW5qZWN0b3IuY29tcG9uZW50UmVmO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgY29tcEluc3RhbmNlKCkge1xuICAgIHJldHVybiB0aGlzLmNvbXBvbmVudFJlZiAmJiB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IGlzQ29tcENoYW5nZWQoKSB7XG4gICAgaWYgKHRoaXMubGFzdENvbXBJbnN0YW5jZSAhPT0gdGhpcy5jb21wSW5zdGFuY2UpIHtcbiAgICAgIHRoaXMubGFzdENvbXBJbnN0YW5jZSA9IHRoaXMuY29tcEluc3RhbmNlO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IGhvc3RJbmplY3RvcigpIHtcbiAgICByZXR1cm4gdGhpcy5jb21wb25lbnRSZWYuaW5qZWN0b3I7XG4gIH1cblxuICBwcml2YXRlIGdldCBob3N0VmNyKCk6IFZpZXdDb250YWluZXJSZWYge1xuICAgIC8vIE5PVEU6IEFjY2Vzc2luZyBwcml2YXRlIEFQSXMgb2YgQW5ndWxhclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbm8tc3RyaW5nLWxpdGVyYWxcbiAgICByZXR1cm4gdGhpcy5jb21wb25lbnRSZWZbJ192aWV3UmVmJ11bJ192aWV3Q29udGFpbmVyUmVmJ107XG4gIH1cblxuICBwcml2YXRlIGdldCByZWZsZWN0KCkge1xuICAgIHJldHVybiAodGhpcy53aW5kb3dSZWYubmF0aXZlV2luZG93IGFzIGFueSkuUmVmbGVjdDtcbiAgfVxuXG4gIHByaXZhdGUgZGlyUmVmID0gbmV3IE1hcDxUeXBlPGFueT4sIERpcmVjdGl2ZVJlZjxhbnk+PigpO1xuICBwcml2YXRlIGRpcklvID0gbmV3IE1hcDxUeXBlPGFueT4sIElvU2VydmljZT4oKTtcbiAgcHJpdmF0ZSBkaXJzRGlmZmVyID0gdGhpcy5pdGVyYWJsZURpZmZlcnNcbiAgICAuZmluZChbXSlcbiAgICAuY3JlYXRlPER5bmFtaWNEaXJlY3RpdmVEZWY8YW55Pj4oKF8sIGRlZikgPT4gZGVmLnR5cGUpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgaXRlcmFibGVEaWZmZXJzOiBJdGVyYWJsZURpZmZlcnMsXG4gICAgcHJpdmF0ZSBpb0ZhY3RvcnlTZXJ2aWNlOiBJb0ZhY3RvcnlTZXJ2aWNlLFxuICAgIHByaXZhdGUgd2luZG93UmVmOiBXaW5kb3dSZWZTZXJ2aWNlLFxuICAgIEBJbmplY3QoRHluYW1pY0NvbXBvbmVudEluamVjdG9yVG9rZW4pXG4gICAgQE9wdGlvbmFsKClcbiAgICBwcml2YXRlIGNvbXBvbmVudEluamVjdG9yPzogRHluYW1pY0NvbXBvbmVudEluamVjdG9yLFxuICApIHt9XG5cbiAgbmdEb0NoZWNrKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLm1heWJlRGVzdHJveURpcmVjdGl2ZXMoKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGRpcnNDaGFuZ2VzID0gdGhpcy5kaXJzRGlmZmVyLmRpZmYodGhpcy5kaXJlY3RpdmVzKTtcblxuICAgIGlmICghZGlyc0NoYW5nZXMpIHtcbiAgICAgIHJldHVybiB0aGlzLnVwZGF0ZURpcmVjdGl2ZXMoKTtcbiAgICB9XG5cbiAgICB0aGlzLnByb2Nlc3NEaXJDaGFuZ2VzKGRpcnNDaGFuZ2VzKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuZGVzdHJveUFsbERpcmVjdGl2ZXMoKTtcbiAgfVxuXG4gIHByaXZhdGUgbWF5YmVEZXN0cm95RGlyZWN0aXZlcygpIHtcbiAgICBpZiAodGhpcy5pc0NvbXBDaGFuZ2VkIHx8ICF0aGlzLmNvbXBvbmVudFJlZikge1xuICAgICAgdGhpcy5kaXJzRGlmZmVyLmRpZmYoW10pO1xuICAgICAgdGhpcy5kZXN0cm95QWxsRGlyZWN0aXZlcygpO1xuICAgIH1cblxuICAgIHJldHVybiAhdGhpcy5jb21wb25lbnRSZWY7XG4gIH1cblxuICBwcml2YXRlIHByb2Nlc3NEaXJDaGFuZ2VzKFxuICAgIGNoYW5nZXM6IEl0ZXJhYmxlQ2hhbmdlczxEeW5hbWljRGlyZWN0aXZlRGVmPGFueT4+LFxuICApIHtcbiAgICBjaGFuZ2VzLmZvckVhY2hSZW1vdmVkSXRlbSgoeyBpdGVtIH0pID0+IHRoaXMuZGVzdHJveURpcmVjdGl2ZShpdGVtKSk7XG5cbiAgICBjb25zdCBjcmVhdGVkRGlycyA9IFtdO1xuICAgIGNoYW5nZXMuZm9yRWFjaEFkZGVkSXRlbSgoeyBpdGVtIH0pID0+XG4gICAgICBjcmVhdGVkRGlycy5wdXNoKHRoaXMuaW5pdERpcmVjdGl2ZShpdGVtKSksXG4gICAgKTtcblxuICAgIGlmIChjcmVhdGVkRGlycy5sZW5ndGgpIHtcbiAgICAgIHRoaXMubmRjRHluYW1pY0RpcmVjdGl2ZXNDcmVhdGVkLmVtaXQoY3JlYXRlZERpcnMuZmlsdGVyKEJvb2xlYW4pKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZURpcmVjdGl2ZXMoKSB7XG4gICAgdGhpcy5kaXJlY3RpdmVzLmZvckVhY2goZGlyID0+IHRoaXMudXBkYXRlRGlyZWN0aXZlKGRpcikpO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVEaXJlY3RpdmUoZGlyRGVmOiBEeW5hbWljRGlyZWN0aXZlRGVmPGFueT4pIHtcbiAgICBjb25zdCBpbyA9IHRoaXMuZGlySW8uZ2V0KGRpckRlZi50eXBlKTtcbiAgICBpby51cGRhdGUoZGlyRGVmLmlucHV0cywgZGlyRGVmLm91dHB1dHMsIGZhbHNlLCBmYWxzZSk7XG4gICAgaW8ubWF5YmVVcGRhdGUoKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdERpcmVjdGl2ZShcbiAgICBkaXJEZWY6IER5bmFtaWNEaXJlY3RpdmVEZWY8YW55PixcbiAgKTogRGlyZWN0aXZlUmVmPGFueT4gfCB1bmRlZmluZWQge1xuICAgIGlmICh0aGlzLmRpclJlZi5oYXMoZGlyRGVmLnR5cGUpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgaW5zdGFuY2UgPSB0aGlzLmNyZWF0ZURpcmVjdGl2ZShkaXJEZWYudHlwZSk7XG4gICAgY29uc3QgZGlyID0ge1xuICAgICAgaW5zdGFuY2UsXG4gICAgICB0eXBlOiBkaXJEZWYudHlwZSxcbiAgICAgIGluamVjdG9yOiB0aGlzLmhvc3RJbmplY3RvcixcbiAgICAgIGhvc3RDb21wb25lbnQ6IHRoaXMuY29tcG9uZW50UmVmLmluc3RhbmNlLFxuICAgICAgaG9zdFZpZXc6IHRoaXMuY29tcG9uZW50UmVmLmhvc3RWaWV3LFxuICAgICAgbG9jYXRpb246IHRoaXMuY29tcG9uZW50UmVmLmxvY2F0aW9uLFxuICAgICAgY2hhbmdlRGV0ZWN0b3JSZWY6IHRoaXMuY29tcG9uZW50UmVmLmNoYW5nZURldGVjdG9yUmVmLFxuICAgICAgb25EZXN0cm95OiB0aGlzLmNvbXBvbmVudFJlZi5vbkRlc3Ryb3ksXG4gICAgfTtcblxuICAgIHRoaXMuaW5pdERpcklPKGRpciwgZGlyRGVmLmlucHV0cywgZGlyRGVmLm91dHB1dHMpO1xuICAgIHRoaXMuY2FsbEluaXRIb29rcyhpbnN0YW5jZSk7XG5cbiAgICB0aGlzLmRpclJlZi5zZXQoZGlyLnR5cGUsIGRpcik7XG5cbiAgICByZXR1cm4gZGlyO1xuICB9XG5cbiAgcHJpdmF0ZSBkZXN0cm95QWxsRGlyZWN0aXZlcygpIHtcbiAgICB0aGlzLmRpclJlZi5mb3JFYWNoKGRpciA9PiB0aGlzLmRlc3Ryb3lEaXJSZWYoZGlyKSk7XG4gICAgdGhpcy5kaXJSZWYuY2xlYXIoKTtcbiAgICB0aGlzLmRpcklvLmNsZWFyKCk7XG4gIH1cblxuICBwcml2YXRlIGRlc3Ryb3lEaXJlY3RpdmUoZGlyRGVmOiBEeW5hbWljRGlyZWN0aXZlRGVmPGFueT4pIHtcbiAgICB0aGlzLmRlc3Ryb3lEaXJSZWYodGhpcy5kaXJSZWYuZ2V0KGRpckRlZi50eXBlKSk7XG4gICAgdGhpcy5kaXJSZWYuZGVsZXRlKGRpckRlZi50eXBlKTtcbiAgICB0aGlzLmRpcklvLmRlbGV0ZShkaXJEZWYudHlwZSk7XG4gIH1cblxuICBwcml2YXRlIGluaXREaXJJTyhkaXI6IERpcmVjdGl2ZVJlZjxhbnk+LCBpbnB1dHM/OiBhbnksIG91dHB1dHM/OiBhbnkpIHtcbiAgICBjb25zdCBpbyA9IHRoaXMuaW9GYWN0b3J5U2VydmljZS5jcmVhdGUoKTtcbiAgICBpby5pbml0KFxuICAgICAgeyBjb21wb25lbnRSZWY6IHRoaXMuZGlyVG9Db21wRGVmKGRpcikgfSxcbiAgICAgIHsgdHJhY2tPdXRwdXRDaGFuZ2VzOiB0cnVlIH0sXG4gICAgKTtcbiAgICBpby51cGRhdGUoaW5wdXRzLCBvdXRwdXRzLCAhIWlucHV0cywgISFvdXRwdXRzKTtcbiAgICB0aGlzLmRpcklvLnNldChkaXIudHlwZSwgaW8pO1xuICB9XG5cbiAgcHJpdmF0ZSBkaXJUb0NvbXBEZWYoZGlyOiBEaXJlY3RpdmVSZWY8YW55Pik6IENvbXBvbmVudFJlZjxhbnk+IHtcbiAgICByZXR1cm4ge1xuICAgICAgY2hhbmdlRGV0ZWN0b3JSZWY6IHRoaXMuY29tcG9uZW50UmVmLmNoYW5nZURldGVjdG9yUmVmLFxuICAgICAgaG9zdFZpZXc6IHRoaXMuY29tcG9uZW50UmVmLmhvc3RWaWV3LFxuICAgICAgbG9jYXRpb246IHRoaXMuY29tcG9uZW50UmVmLmxvY2F0aW9uLFxuICAgICAgZGVzdHJveTogdGhpcy5jb21wb25lbnRSZWYuZGVzdHJveSxcbiAgICAgIG9uRGVzdHJveTogdGhpcy5jb21wb25lbnRSZWYub25EZXN0cm95LFxuICAgICAgaW5qZWN0b3I6IHRoaXMuY29tcG9uZW50UmVmLmluamVjdG9yLFxuICAgICAgaW5zdGFuY2U6IGRpci5pbnN0YW5jZSxcbiAgICAgIGNvbXBvbmVudFR5cGU6IGRpci50eXBlLFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGRlc3Ryb3lEaXJSZWYoZGlyOiBEaXJlY3RpdmVSZWY8YW55Pikge1xuICAgIGNvbnN0IGlvID0gdGhpcy5kaXJJby5nZXQoZGlyLnR5cGUpO1xuICAgIGlvLm5nT25EZXN0cm95KCk7XG5cbiAgICBpZiAoJ25nT25EZXN0cm95JyBpbiBkaXIuaW5zdGFuY2UpIHtcbiAgICAgIGRpci5pbnN0YW5jZS5uZ09uRGVzdHJveSgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlRGlyZWN0aXZlPFQ+KGRpclR5cGU6IFR5cGU8VD4pOiBUIHtcbiAgICBjb25zdCBkaXJlY3RpdmVJbmplY3RvciA9IEluamVjdG9yLmNyZWF0ZSh7XG4gICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHByb3ZpZGU6IGRpclR5cGUsXG4gICAgICAgICAgdXNlQ2xhc3M6IGRpclR5cGUsXG4gICAgICAgICAgZGVwczogdGhpcy5yZXNvbHZlRGlyUGFyYW1UeXBlcyhkaXJUeXBlKSxcbiAgICAgICAgfSxcbiAgICAgICAgeyBwcm92aWRlOiBFbGVtZW50UmVmLCB1c2VWYWx1ZTogdGhpcy5jb21wb25lbnRSZWYubG9jYXRpb24gfSxcbiAgICAgIF0sXG4gICAgICBwYXJlbnQ6IHRoaXMuaG9zdEluamVjdG9yLFxuICAgICAgbmFtZTogYER5bmFtaWNEaXJlY3RpdmVJbmplY3Rvcjoke2RpclR5cGUubmFtZX1AJHt0aGlzLmNvbXBvbmVudFJlZi5jb21wb25lbnRUeXBlLm5hbWV9YCxcbiAgICB9KTtcblxuICAgIHJldHVybiBkaXJlY3RpdmVJbmplY3Rvci5nZXQoZGlyVHlwZSk7XG4gIH1cblxuICBwcml2YXRlIHJlc29sdmVEaXJQYXJhbVR5cGVzKGRpclR5cGU6IFR5cGU8YW55Pik6IGFueVtdIHtcbiAgICByZXR1cm4gKFxuICAgICAgLy8gRmlyc3QgdHJ5IEFuZ3VsYXIgQ29tcGlsZXIncyBtZXRhZGF0YVxuICAgICAgZXh0cmFjdE5nUGFyYW1UeXBlcyhkaXJUeXBlKSA/P1xuICAgICAgLy8gVGhlbiBmYWxsYmFjayB0byBUeXBlc2NyaXB0IFJlZmxlY3QgQVBJXG4gICAgICBnZXRDdG9yUGFyYW1UeXBlcyhkaXJUeXBlLCB0aGlzLnJlZmxlY3QpID8/XG4gICAgICAvLyBCYWlsb3V0XG4gICAgICBbXVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGNhbGxJbml0SG9va3Mob2JqOiBhbnkpIHtcbiAgICB0aGlzLmNhbGxIb29rKG9iaiwgJ25nT25Jbml0Jyk7XG4gICAgdGhpcy5jYWxsSG9vayhvYmosICduZ0RvQ2hlY2snKTtcbiAgICB0aGlzLmNhbGxIb29rKG9iaiwgJ25nQWZ0ZXJDb250ZW50SW5pdCcpO1xuICAgIHRoaXMuY2FsbEhvb2sob2JqLCAnbmdBZnRlckNvbnRlbnRDaGVja2VkJyk7XG4gICAgdGhpcy5jYWxsSG9vayhvYmosICduZ0FmdGVyVmlld0luaXQnKTtcbiAgICB0aGlzLmNhbGxIb29rKG9iaiwgJ25nQWZ0ZXJWaWV3Q2hlY2tlZCcpO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxsSG9vayhvYmo6IGFueSwgaG9vazogc3RyaW5nLCBhcmdzOiBhbnlbXSA9IFtdKSB7XG4gICAgaWYgKG9ialtob29rXSkge1xuICAgICAgb2JqW2hvb2tdKC4uLmFyZ3MpO1xuICAgIH1cbiAgfVxufVxuIl19